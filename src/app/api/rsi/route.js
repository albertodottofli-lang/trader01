import yahooFinance from 'yahoo-finance2';
function calcRSI(closes, period=14){ if (closes.length<=period) return null; let gains=0, losses=0; for (let i=closes.length-period;i<closes.length;i++){ const d=closes[i]-closes[i-1]; if (d>0) gains+=d; else losses+=Math.abs(d); } const ag=gains/period, al=losses/period; if (al===0) return 100; const rs=ag/al; return +(100 - 100/(1+rs)).toFixed(2); }
export async function GET(req){ const { searchParams } = new URL(req.url); const symbol = searchParams.get('symbol')||'AAPL'; try{ const history = await yahooFinance.historical(symbol, { period:'1mo' }); const closes = history.map(h=>h.close).reverse(); const rsi = calcRSI(closes,14); return new Response(JSON.stringify({ symbol, rsi }), { status:200 }); }catch(e){ console.error(e); return new Response(JSON.stringify({ error:'rsi error' }), { status:500 }); } }
